---
title: Troubleshooting MySQL for PCF
owner: MySQL
---

This topic provides operators with basic instructions for troubleshooting on-demand MySQL for PCF.

For information on temporary MySQL for PCF service interruptions, see [Service Interruptions](./upgrade.html#interruptions).

For information on leader-follower specific problems, see [Troubleshooting Leader-Follower Instances](./troubleshoot-leader-follower.html).

## <a id="errors"></a>Troubleshooting Errors

This section provides information on how to troubleshooting specific errors or error messages. 

### <a id="install-fail"></a>Failed Install

<%= partial '../../mysql/odb/tshoot-err-install-fail' %>

### <a id="cannot-create-delete"></a>Cannot Create or Delete Service Instances

<%= partial '../../mysql/odb/tshoot-err-cannot-create-delete' %>

### <a id="timeouts"></a>Broker Request Timeouts

<%= partial '../../mysql/odb/tshoot-err-timeouts' %>

### <a id="cannot-bind"></a>Cannot Bind to or Unbind from Service Instances

#### <a id="instance-not-exist"></a>Instance Does Not Exist

<%= partial '../../mysql/odb/tshoot-err-instance-not-exist' %>

#### <a id="other-errors"></a>Other Errors

<%= partial '../../mysql/odb/tshoot-err-other-errors' %>

### <a id="cannot-connect"></a>Cannot Connect to a Service Instance

<%= partial '../../mysql/odb/tshoot-err-cannot-connect' %>

Service instances can also become temporarily inaccessible during upgrades and VM or network failures. See [Service Interruptions](./upgrade.html#interruptions) for more information.

### <a id="upgrade-all-fails"></a>Upgrade All Instances Fails

<%= partial '../../mysql/odb/tshoot-err-upgrade-all-fails' %>

### <a id="missing-logs"></a>Missing Logs and Metrics

<%= partial '../../mysql/odb/tshoot-err-missing-logs' %>

<h3><a id="unable-to-determine"></a>Unable to Determine Leader and Follower (Errand Error)</h3>

This problem happens when the <code>configure-leader-follower</code> errand fails because it cannot determine the VM roles.

<h4>Symptom</h4>
The <code>configure-leader-follower</code> errand exits with <code>1</code> and the errand logs contain the following:

<pre><code>
Unable to determine leader and follower based on transaction history.
</code></pre>

<h4>Explanation</h4>
Something has happened to the instances, such as a failure or manual intervention. As a result, there is not enough
information available to determine the correct state and topology without operator intervention to resolve the issue.

<h4>Solution</h4>

Use the <code>inspect</code> errand to determine which instance should be the leader. Then, using the <a href="./about-leader-follower.html#errands">orchestration</a> errands and backup/restore, you can
put the service instance into a safe topology, and then rerun the <code>configure-leader-follower</code> errand. This is shown in the example below.

This example shows one outcome that the <code>inspect</code> errand can return: 

<ol>
<li>Use the <code>inspect</code> errand to retrieve relevant information about the two VMs:
<pre class="terminal">
$ bosh2 -e my-env -d my-dep run-errand inspect
[...]
Instance   mysql/4ecad54b-0704-47eb-8eef-eb228cab9724
Exit Code  0
Stdout     -
Stderr     2017/12/11 18:25:54 Started executing command: inspect
         2017/12/11 18:25:54 Started GET https<span>:</span>//127.0.0.1:8443/status
         2017/12/11 18:25:54
         Has Data: false
         Read Only: true
         GTID Executed: 1d774323-de9e-11e7-be01-42010a001014:1-25
         Replication Configured: false<br /><br />
Instance   mysql/e0b94ade-0114-4d49-a929-ce1616d8beda
Exit Code  0
Stdout     -
Stderr     2017/12/11 18:25:54 Started executing command: inspect
         2017/12/11 18:25:54 Started GET https<span>:</span>//127.0.0.1:8443/status
         2017/12/11 18:25:54
         Has Data: true
         Read Only: true
         GTID Executed: 1d774323-de9e-11e7-be01-42010a001014:1-25
         Replication Configured: true<br /><br />
2 errand(s)<br />
Succeeded
</pre>
In the above scenario, the first instance is missing data but does not have replication configured. The second instance
has data, and also has replication configured. The instructions below resolve this by copying data to the first instance,
and resuming replication.</li>
<li>Take a backup of the first instance using the <a href="backup-and-restore.html#manual-backup">Manual Backup</a> steps.</li>
<li>Restore the backup artifact to the first instance using the <a href="backup-and-restore.html#restore">Manual Restore</a> steps.<br><br>
	At this point, the instances have equivalent data.</li>
<li> Run the <code>configure-leader-follower</code> errand to reconfigure replication:
<pre class="terminal">
$ bosh2 -e my-env -d my-dep run-errand configure-leader-follower --instance=mysql/INDEX\_OF\_LEADER
</pre></li>

<h3><a id="both-writable"></a>Both Leader and Follower Instances Are Writable (Errand Error)</h3>

This problem happens when the <code>configure-leader-follower</code> errand fails because both VMs are writable 
and the VMs might hold differing data.

<h4>Symptom</h4>

The <code>configureâ€“leader-follower</code> errand exits with <code>1</code> and the errand logs contain the following:<br><br>

<pre><code>
Both mysql instances are writable. Please ensure no divergent data and set one instance to read-only mode.
</code></pre>

<h4>Explanation</h4>

MySQL for PCF tries to ensure that there is only one writable instance of the leader-follower pair at any given time.
However, in certain situations, such as
network partitions, or manual intervention outside of the provided bosh errands, it is possible for both instances
to be writable.

The service instances remain in this state until an operator resolves the issue to ensure that the correct instance is
promoted and reduce the potential for data divergence.

<h4>Solution</h4>

<ol>
<li> Use the <code>inspect</code> errand to retrieve the GTID Executed set for each VM:
<pre class="terminal">
$ bosh2 -e my-env -d my-dep run-errand inspect
[...]
Instance   mysql/4ecad54b-0704-47eb-8eef-eb228cab9724
Exit Code  0
Stdout     -
Stderr     2017/12/11 18:25:54 Started executing command: inspect
         2017/12/11 18:25:54 Started GET https<span>:</span>127.0.0.1:8443/status
         2017/12/11 18:25:54
         Has Data: true
         Read Only: true
         GTID Executed: 1d774323-de9e-11e7-be01-42010a001014:1-25
         Replication Configured: false<br /><br />
Instance   mysql/e0b94ade-0114-4d49-a929-ce1616d8beda
Exit Code  0
Stdout     -
Stderr     2017/12/11 18:25:54 Started executing command: inspect
         2017/12/11 18:25:54 Started GET https<span>:</span>127.0.0.1:8443/status
         2017/12/11 18:25:54
         Has Data: true
         Read Only: true
         GTID Executed: 1d774323-de9e-11e7-be01-42010a001014:1-25
         Replication Configured: false<br /><br />
2 errand(s)<br />
Succeeded
</pre>
If the GTID Executed sets for both instances are the same, continue to Step 2. If they are different, continue to Step 4.</li>
<li>Look at the value of GTID Executed for both instances.
    <ul><li>If the range after the GUID is equivalent, either instance can be made read-only, as described in Step 3.</li>
    <li>If one instance has a range that is a subset of the other, the instance with the subset should be made read-only, as
      described in Step 3.</li></ul></li>
<li>Based on the information you gathered in the step above, run the <code>make-read-only</code> errand to make the appropriate instance read-only:
<pre class="terminal">
$ bosh2 -e my-env -d my-dep run-errand make-read-only --instance=mysql/MYSQL\_SUBSET\_INSTANCE
[...]
Succeeded
</pre></li>
<li>If the GTID Executed sets are neither equivalent nor subsets, 
   data has diverged and you must determine what data has diverged as part of the procedure below:
   <ol>
	<li>Use the <code>make-read-only</code> errand to set both instances to read-only to prevent further data divergence.
    <pre class="terminal">$ bosh2 -e my-env -d my-dep run-errand make-read-only --instance=mysql/MYSQL\_SUBSET\_INSTANCE
    [...]
    Succeeded</pre></li>
	<li>Take a backup of both instances using the <a href="backup-and-restore.html#manual-backup">Manual Backup</a> steps.</li>
	<li>Manually inspect the data on each instance to determine the discrepancies and put the data on the instance that is
    further ahead---this instance has the higher GTID Executed set, and will be the new leader.</li>   
	<li>Migrate all appropriate data to the new leader instance.</li>
	<li>After putting all data on the leader, ssh onto the follower:
    <pre class="terminal">$ bosh2 -e my-env -d my-dep ssh mysql/INDEX\_OF\_FOLLOWER</pre></li>
	<li>Become root with the command <code>sudo su</code>.<br><br></li>
	<li>Stop the mysql process with the command <code>monit stop mysql</code>.</li>
	<li>Delete the data directory of the follower with the command <code>rm -rf /var/vcap/store/mysql</code>.</li>
	Use the <code>configure-leader-follower</code> errand to copy the leader's data to the follower and resume replication:
    <pre class="terminal">$ bosh2 -e my-env -d my-dep run-errand configure-leader-follower --instance=mysql/INDEX\_OF\_LEADER</pre></li>
</ol>
</li>
</ol>

## <a id="components"></a>Troubleshooting Components

This section provides guidance on checking for and fixing issues in on-demand service components.

### <a id="bosh"></a>BOSH problems

#### <a id="no-bosh-uuid"></a>Missing BOSH Director UUID

<%= partial '../../mysql/odb/tshoot-comp-no-bosh-uuid' %>

#### <a id="large-queue"></a>Large BOSH Queue

<%= partial '../../mysql/odb/tshoot-comp-large-queue' %>

### <a id="bosh-config"></a>Configuration

#### <a id="bosh-instance-fail"></a>Service instances in failing state

<%= partial '../../mysql/odb/tshoot-comp-bosh-instance-fail' %>

### <a id="auth"></a>Authentication

#### <a id="uaa-change"></a>UAA Changes

<%= partial '../../mysql/odb/tshoot-comp-uaa-change' %>

### <a id="network"></a>Networking

<%= partial '../../mysql/odb/tshoot-comp-network' %>

#### <a id="broker-to-instances"></a>Validate Service Broker Connectivity to Service Instances

<%= partial '../../mysql/odb/tshoot-comp-broker-to-instances' %>

#### <a id="app-to-instances"></a>Validate App Access to Service Instance

<%= partial '../../mysql/odb/tshoot-comp-app-to-instances' %>

### <a id="quotas"></a>Quotas

#### <a id="plan-quotas"></a>Plan Quota issues

<%= partial '../../mysql/odb/tshoot-comp-plan-quotas' %>

#### <a id="global-quotas"></a>Global Quota Issues

<%= partial '../../mysql/odb/tshoot-comp-global-quotas' %>

### <a id="failing-jobs"></a>Failing Jobs and Unhealthy Instances

<%= partial '../../mysql/odb/tshoot-comp-failing-jobs' %>

A failing process or failing VM might come back automatically after a temporary service outage. See [VM Process Failure](./upgrade.html#process-fail) and [VM Failure](./upgrade.html#vm-fail).

### <a id="az-region-fail"></a>AZ or Region Failure

Failures at the IaaS level, such as Availability Zone (AZ) or region  failures, can interrupt service and require manual restoration. See [AZ Failure](./upgrade.html#az-fail) and [Region Failure](./upgrade.html#region-fail)

## <a id="techniques"></a>Techniques for Troubleshooting

Instructions on interacting with the on-demand service broker and on-demand service instance BOSH deployments, and on performing general maintenance and housekeeping tasks

### <a id="parse-error"></a>Parse a Cloud Foundry (CF) Error Message

<%= partial '../../mysql/odb/tshoot-tech-parse-error' %>

### <a id="bosh-cf-access"></a>Access Broker and Instance Logs and VMs

<%= partial '../../mysql/odb/tshoot-tech-bosh-cf-access' %>

#### <a id="access-broker"></a>Access Broker Logs and VM(s)

<%= partial '../../mysql/odb/tshoot-tech-access-broker' %>

#### <a id="access-instance"></a>Access Service Instance Logs and VMs

<%= partial '../../mysql/odb/tshoot-tech-access-instance' %>

### <a id="broker-errands"></a>Run Service Broker Errands to Manage Brokers and Instances

<%= partial '../../mysql/odb/tshoot-tech-broker-errands' %>

#### <a id="register-broker"></a>Register Broker

<%= partial '../../mysql/odb/tshoot-tech-register-broker' %>

#### <a id="deregister-broker"></a>Deregister Broker

<%= partial '../../mysql/odb/tshoot-tech-deregister-broker' %>

#### <a id="upgrade-all"></a>Upgrade All Service Instances

<%= partial '../../mysql/odb/tshoot-tech-upgrade-all' %>

#### <a id="delete-all"></a>Delete All Service Instances

<%= partial '../../mysql/odb/tshoot-tech-delete-all' %>

### <a id="detect-orphans"></a>Detect Orphaned Instances Service Instances

<%= partial '../../mysql/odb/tshoot-tech-detect-orphans' %>

### <a id="instance-deployment"></a>Select the BOSH Deployment for a Service Instance

<%= partial '../../mysql/odb/tshoot-tech-instance-deployment' %>

### <a id="instance-creds"></a>Get Admin Credentials for a Service Instance

<%= partial '../../mysql/odb/tshoot-tech-instance-creds' %>

### <a id="reinstall"></a>Reinstall a Tile

<%= partial '../../mysql/odb/tshoot-tech-reinstall' %>

### <a id="view-resources"></a>View Resource Saturation and Scaling

<%= partial '../../mysql/odb/tshoot-tech-view-resources' %>

### <a id="id-instance-owner"></a>Identify Service Instance Owner

<%= partial '../../mysql/odb/tshoot-tech-id-instance-owner' %>

### <a id="monitor-quota"></a>Monitor Quota Saturation and Service Instance Count

<%= partial '../../mysql/odb/tshoot-tech-monitor-quota' %>

## <a id="kb"></a>Knowledge Base (Community)

<%= partial '../../mysql/odb/tshoot-kb' %>

## <a id="support"></a>File a Support Ticket

<%= partial '../../mysql/odb/tshoot-support' %>
