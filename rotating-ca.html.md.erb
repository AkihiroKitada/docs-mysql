---
title: Rotating Certificates
owner: MySQL
---

<div class="quick-links">
<ul>
  <li>
    <a href="#overview">Types of Certificates</a>
  </li>
  <li>
    <a href="#mysql-certs">Certificates Used by <%= vars.product_short %></a>
  </li>
  <li>
    <a href="#workflow">Workflow</a>
  </li>
  <%= partial "./certs/rotating-certs-toc.html.erb" %>
  <li>
    <a href="#internal">Rotate Internal Certificates</a>
  </li>
</ul>
</div>

<strong><%= modified_date %></strong>

This topic describes how to check expiration dates and rotate certificates used by MySQL for PCF.

## <a id="overview"></a> Types of Certificates

MySQL for PCF uses the following types of certificates:

+ **TLS certificates managed by the operator:** If you are using TLS for MySQL for PCF,
you provided a CA certificate to BOSH CredHub when you did the procedures	in [Preparing for TLS](prepare-tls.html). Operators must manually rotate this TLS CA certificate before the certificate expires or if it is compromised.

+ **Internal certificates managed by MySQL for PCF:** When you upgrade to MySQL for PCF v2.6,
MySQL for PCF automatically rotates the internal certificates
for single node and leader-follower service instances. The new certificates do not expire for 5 years.
For more information, see [Rotate Internal Certificates](#internal) below.
<p class="note"><strong>Note:</strong> MySQL for PCF v2.6 does not rotate certificates for highly available (HA) clusters service instances.
To rotate these certificates, you must upgrade to MySQL for PCF v2.7. See <a href="https://docs.pivotal.io/p-mysql/2-7/upgrade.html">Upgrading MySQL for PCF</a>.
</p>

For a list of the certificates used by MySQL for PCF, see [Certificates Used by MySQL for PCF](#mysql-certs)
below.

<p class="note warning"><strong>Warning</strong>: Do not attempt to rotate a CA certificate on your own.
Contact <a href="https://support.pivotal.io">Pivotal Support</a>
and perform the following procedures with their help.
</p>

### <a id="mysql-certs"></a> Certificates Used by MySQL for PCF

The following table lists the certificates used by MySQL for PCF:

<table>
  <tr>
    <th width="75%"">Certificate</th>
    <th>Rotated by MySQL for PCF?</th>
  </tr>

  <tr>
    <th colspan="2">TLS Certificates</th>
  </tr>

  <tr>
    <td><code>/services/tls_ca</code></td>
    <td>No</td>
  </tr>

  <tr>
    <td><code>/p-bosh/service-instance_GUID/mysql_tls</code></td>
    <td>No</td>
  </tr>

  <tr>
    <th colspan="2">Internal HA Certificates</th>
  </tr>

  <tr>
    <td><code>/p-bosh/service-instance_GUID/pxc_tls_ca</code></td>
    <td>No</td>
  </tr>

  <tr>
    <td><code>/p-bosh/service-instance_GUID/pxc_tls_server</code></td>
    <td>No</td>
  </tr>

  <tr>
    <td><code>/p-bosh/service-instance_GUID/pxc_internal_ca</code></td>
    <td>No</td>
  </tr>

  <tr>
    <th colspan="2">Internal Single Node and Leader Follower Certificates</th>
  </tr>

  <tr>
    <td><code>/p-bosh/pivotal-mysql_GUID/agent_ca_2_6_x</code></td>
      <td>Yes</td>
  </tr>

  <tr>
    <td><code>/p-bosh/pivotal-mysql_GUID/agent_client_ssl_2_6_x</code></td>
    <td>Yes</td>
  </tr>

  <tr>
    <td><code>/p-bosh/pivotal-mysql_GUID/agent_server_ssl_2_6_x</code></td>
    <td>Yes</td>
  </tr>

    <tr>
      <td><code>/p-bosh/service-instance_GUID/agent_ca</code></td>
      <td>Yes</td>
    </tr>

    <tr>
      <td><code>/p-bosh/service-instance_GUID/agent_client_tls</code></td>
      <td>Yes</td>
    </tr>

    <tr>
      <td><code>/p-bosh/service-instance_GUID/agent_server_tls</code></td>
      <td>Yes</td>
    </tr>

      <tr>
        <td><code>/p-bosh/service-instance_GUID/streaming_backup_ca</code></td>
        <td>Yes</td>
      </tr>

      <tr>
        <td><code>/p-bosh/service-instance_GUID/streaming_backup_server_cert</code></td>
        <td>Yes</td>
      </tr>
</table>

In the above table, `GUID` is the GUID for the service instance. To find the GUID
of your service instance, do the procedure in
[Find Information about Your Service Instance](./troubleshoot-instances.html#instance).

## <a id="workflow"></a> Workflow

 Depending on which of your certificates are expiring, you must complete different procedures.
 The following flowchart describes the workflow for rotating certificate:

![A flowchart that explains the workflow for rotating certs.](./images/rotate-certs.png)

<a href="./images/rotate-certs.png" target="_blank">View a larger version of this flowchart</a>

To rotate your certificates:

1. Determine which of your certificates are expiring. See [Check Expiration Dates](#check) below.
1. If any of your certificates are about to expire or have expired, do one of the following:
  * **If your TLS certificates are about to expire or have expired:**
    Do the procedures in [Rotate CA Certificates Manually](#tls) below.
    This rotates both the TLS certificates and the internal certificates.
  * **If your internal certificates for single node or leader-follower service instances are about to expire or have expired:** Do the procedure in [Rotate Internal Certificates](#internal) below.<br><br>
  * **If only your internal certificates for HA clusters are about to expire or have expired:** Upgrade to MySQL for PCF v2.7.
  See [Upgrading MySQL for PCF](https://docs.pivotal.io/p-mysql/2-7/upgrade.html).
<%= partial "./certs/rotating-certs", :locals => { :local_product_name => "MySQL for PCF" } %>


## <a id="internal"></a> Rotate Internal Certificates

When you upgrade to MySQL for PCF v2.6, MySQL for PCF automatically
rotates the internal certificates single node and leader-follower service instances. The new certificates do not expire for 5 years.
The below commands upgrade all of your MySQL for service instances and distribute the new certificates to your service instances.

To ensure that the internal certificates rotate, do one of the following:

+ **If you have not upgraded to MySQL for PCF v2.6:** Do the following:
    1. Navigate to the <%= vars.ops_manager %> Installation Dashboard and click the **MySQL for Pivotal Cloud Foundry v2** tile.
    1. Click **Errands**.
    1. Under **Post-Deploy Errands**, ensure that **Upgrade all On-demand MySQL Service Instances** is set to **Default (On)**.

          ![Upgrade All Instances Errand](upgrade-all-instances-errand.png)
    1. Click **Save.**

+ **If you have already upgraded to MySQL for PCF v2.6 without the Upgrade all On-demand MySQL Service Instances errand on:** Run the following command:

    ```
    bosh -d p-mysql-GUID run-errand upgrade-all-service-instances
    ```

    Where `pivotal-mysql-GUID` is the BOSH deployment name for your MySQL service broker.

    For a list of certificates used by MySQL for PCF,
      see [Certificates Used by MySQL for PCF](#mysql-certs) above.
