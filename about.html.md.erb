---
title: On-Demand Service Architecture
owner: MySQL
---

<p class="note warning"><strong>Warning:</strong> <%= vars.first_product_name %> 
	v<%= product_info['local_product_version'] %> is no longer supported 
because it has reached the End of General Support (EOGS) phase.
To stay up to date with the latest software and security updates,
upgrade to a supported version.
</p>

This topic describes the architecture for on-demand MySQL for Pivotal Cloud Foundry (PCF).

For information about architecture of the older, pre-provisioned service, see the [Architecture](http://docs.pivotal.io/p-mysql/1-10/architecture.html) topic for MySQL for PCF v1.10.

## <a id="service-network"></a>Service Network Requirement

<%= partial '../../p-mysql/partials/services/service-networks-v2' %>


## <a id='on-demand'></a>Default Network and Service Network

<%= partial '../../p-mysql/partials/services/on_demand_architecture' %>

## <a id="rules"></a> Required Networking Rules for On-Demand Services

<!-- The below partial is in https://github.com/pivotal-cf/docs-partials -->

<%= partial '../../p-mysql/partials/services/service_networks_table' %>

Regardless of the specific network layout, the operator must ensure network rules are set up so that connections are open as described in the table below.

<table class="nice">
	<th>This component...</th>
	<th>Must communicate with...</th>
	<th>Default TCP Port</th>
	<th>Communication direction(s)</th>
	<th>Notes</th>
	<tr>
		<td><strong>BOSH Agent</strong></td>
		<td><strong>BOSH Director</strong></td>
		<td>4222</td>
		<td>Two-way</td>
		<td>The BOSH Agent runs on every VM in the system, including the BOSH Director VM.
                    The BOSH Agent initiates the connection with the BOSH Director.<br>
		    The default port is not configurable.  </td>
	</tr>
	<tr>
		<td><strong>Broker and Service Instances</strong></td>
		<td><strong>Doppler on PAS</strong></td>
		<td>8082</td>
		<td>One-way</td>
		<td>This port is for metrics.</td>
	</tr>
	<tr>
		<td><strong>Deployed Apps on PAS</strong></td>
		<td><strong>MySQL Service Instances</strong></td>
		<td>3306</td>
		<td>One-way</td>
		<td>This port is for general use, app-specific tasks.
                    In addition to configuring your IaaS, create a security group
                    for the MySQL service instance.</td>
	</tr>
	<tr>
		<td><strong>Leader VM</strong></td>
		<td><strong>Follower VM</strong></td>
		<td>8443<br>8081</td>
		<td>Two-way</td>
		<td>This port is needed if leader-follower is enabled.
                    For information, see <a href="maintain-leader-follower.html#config-plan">Configure a Leader-Follower Service Plan</a>.</td>
	</tr>
	<tr>
		<td><strong>ODB</strong></td>
		<td>
		    <ul>
		        <li><strong>BOSH Director</strong></li>
		    	<li><strong>BOSH UAA</strong></li>
		    </ul>
		</td>
		<td>
			<ul>
				<li>25555</li>
				<li>8443</li>
			</ul>
		</td>
		<td>One-way</td>
		<td>The default ports are not configurable.</td>
	</tr>
	<tr>
		<td><strong>ODB</strong></td>
		<td><strong>MySQL service instances</strong>
		</td>
		<td>3306</td>
		<td>One-way</td>
		<td>This connection is for administrative tasks. Avoid opening general use, app-specific ports for this connection.</td>
	</tr>
	<tr>
		<td><strong>ODB</strong></td>
		<td><strong>PAS</strong>
		</td>
		<td>8443</td>
		<td>One-way</td>
		<td>The default port is not configurable.</td>
	</tr>
	<tr>
		<td><strong>PAS</strong></td>
		<td><strong>ODB</strong>
		</td>
		<td>8080</td>
		<td>One-way</td>
		<td>This port allows PAS to communicate with the ODB component.</td>
	</tr>
	<tr>
		<td><strong>Deployed apps on PAS</strong></td>
		<td><strong>Runtime CredHub</strong>
		</td>
		<td>8844</td>
		<td>One-way</td>
		<td>This port is needed if secure service instance credentials are enabled.
                    For information, see <a href="install-config.html#security">Configure Security</a>.</td>
	</tr>
</table>
